#pragma once
#include "GAME14.h"
namespace GAME14 {
	//EXPLOIT
	/*
	class EXPLOIT {
	private:
		bool Commander = false;
		bool Commander_Move = false;
		typedef struct {
			int Position_Y;
			int Position_X;
		}MOVE;
		typedef struct {
			int count;
			MOVE move[8];
		}KOMA;

		KOMA komaInfo[3];
#define SIDE 5
		int matrix[SIDE][SIDE];
		bool Available_Move = false;
		int TILE_SIZE = 128;
	public:
		EXPLOIT() {
			komaInfo[0] = { 8, { {-1,-1},{-1,0},{-1,1},{0,-1},{0,1},{1,-1},{1,0},{1,1} } };
			komaInfo[1] = { 5,{{-1,0},{0,1},{0,-1},{1,1},{1,-1}} };
			komaInfo[2] = { 5,{{-1,1},{-1,-1},{1,0},{1,1},{1,-1}} };
		}
		void Displey(int index) {
			int x, y;
			static const char* komaname[] = {
				"asterisk","pentagram","strider"
			};
			printf("\n%s\n", komaname[index]);
			for (y = 0; y < SIDE; y++) {
				for (x = 640; x < SIDE; x++) {//1920/3.
					if (matrix[y][x] == 2) {
						text("▲", x * TILE_SIZE, y * TILE_SIZE);
						text("□", x * TILE_SIZE, y * TILE_SIZE);
						//printf("▲");
						Available_Move = false;
					}
					else if (matrix[y][x] == 1) {
						text("■", x * TILE_SIZE, y * TILE_SIZE);
						//printf("■");
					Available_Move = true;
					}
					else {
						text("□", x * TILE_SIZE, y * TILE_SIZE);
						Available_Move = false;
					}
				}
			}
		}
		bool Click_TILE() {
			int tileX = mouseX / TILE_SIZE;
			int tileY = mouseY / TILE_SIZE;

			if (tileX < 0 || tileX >= SIDE || tileY < 0 || tileY >= SIDE) return false;

			// 駒の位置をクリックしたら動かすモードへ
			if (matrix[tileY][tileX] == 2) {
				MovePosition(0, tileY, tileX);
				return true;
			}
			return false;
		}
		void Clear() {
			int x, y;
			for (y = 0; y < SIDE; y++) {
				for (x = 0; x < SIDE; x++) {
					matrix[y][x] = Available_Move = false;
				}
			}
		}
		void SetCommander(bool flag) {
			Commander = flag;
		}
		void MovePosition(int index,int TILE_X,int TILE_Y) {
			int i, x, y;
			KOMA k = komaInfo[index];
			//matrix[2][2] = 2;
			Commander_Move = false;
			for (i = 0; i < k.count; i++) {
				x = TILE_X;
				y = TILE_Y;
				while (1) {
					y += k.move[i].Position_Y;
					x += k.move[i].Position_X;
					if (y < 0 || y >= SIDE || x < 0 || x >= SIDE) {
						break;
					}
					matrix[y][x] = 1;
					if (!Commander)break;//whileの中身.
					if (Commander_Move == true)break;
					Commander_Move = false;
				}
			}
		}
	};
	*/
	class EXPLOIT {
		bool Debug = true;
		int Debug_Num = 0;
		bool Commander = false;
		bool Red_Boost_Flag = false;
		bool Blue_Boost_Flag = false;
		int WIDTH = 0;
		int HEIGHT = 0;
		float Position_X = 0;
		float Position_Y = 0;
		float Position_X_2 = 0;
		float Position_Y_2 = 0;
		int text_Potition_X = 0;
		int text_Potition_Y = 0;
		int text_Size = 0;
		typedef struct MOVE {
			int Position_Y = 0;
			int Position_X = 0;
		};
		typedef struct KOMA {
			int count = 0;
			MOVE move[8] = {};
		};
		/*
			int Lv1 = 0;
			int Lv1_enemy = 0;
			int Lv2 = 0;
			int Lv2_enemy = 0;
			int Lv3 = 0;
			int Lv3_enemy = 0;
			int bommer = 0;
			int bommer_enemy = 0;
			int Commander = 0;
			int Commander_enemy = 0;
		*/
		int Image[5][2] = {};
		int koma_Image[5] = {};
		KOMA komaInfo[5];//"asterisk","pentagram","strider".
		struct CELL {
			bool exist = false;
			int team = 0;
			int level = 0;
			int komaType = 0;
			bool movable = false;
			bool disclosure = false;
		};
		CELL board[9][5] = {};
		int matrix[9][5] = {};
		bool Available_Move = false;
		int TILE_SIZE = 0;
		enum CellType {
			EMPTY = 0,
			BLUE_UNIT,
			RED_UNIT,
			FRAME,
			SELECTABLE,
		};
		enum Turn {
			PLAYER,ENEMY,NEXT_P,NEXT_E
		};
		enum Level {
			commander=0,
			Lv1,
			Lv2,
			Lv3,
			Bommer,
		};
		int now_Turn = 0;
		bool gameOver = false;
		int winner = -1;
		int rule_num[6] = {};
		int rule_page = 0;
	public:
		bool hasSelected = false;
		int selectedRow = -1;
		int selectedCol = -1;
		int selectedKomaType = -1;
		EXPLOIT() {
			komaInfo[0] = { 8, { {-1,-1},{-1,0},{-1,1},{0,-1},{0,1},{1,-1},{1,0},{1,1} } };
			komaInfo[1] = { 5,{{-1,1},{-1,-1},{1,0},{1,1},{1,-1}} };//pentagram_blue
			komaInfo[2] = { 5,{{-1,0},{0,1},{0,-1},{1,1},{1,-1}} };//asterisk_blue
			komaInfo[3] = { 5,{{1,-1},{1,1},{-1,0},{-1,-1},{-1,1}} };//pentagram_red
			komaInfo[4] = { 5,{{1,0},{0,-1},{0,1},{-1,-1},{-1,1}} };//asterisk_red

		}
		void SET_IMAGE();
		void INIT();
		void Clear();
		void Koma_Moves(int komaIndex, int ky, int kx);
		void Draw_Board();

		bool Mouse_To_Cell(int mx, int my, int& r, int& c);

		bool MOUSE_JUDGE(int WIDTH, int HEIGHT, float Pos_X, float Pos_Y);
		int TITLE_DRAW();
		void PLAY_INIT();
		bool JUDGE_CAN_MOVE(int x, int y);
		bool IsBluePlacementZone(int row);
		void PlaceBlueUnit(int row, int col);
		void Setup_Cell_color();
		bool IsMyUnit(int row, int col);
		void SHOW_MOVABLE_AREA(int komaType, int row, int col);
		void KOMA_MOVE(int toRow, int toCol);
		void Clear_Movable();
		void SELECT_KOMA(int y, int x);
		void Click_Cell(int r, int c);
		void Select_Cancel();
		void DEBUG_DRAW();
		bool HasCommander(int team);
		bool Check_GameOver();
		void DRAW_Game_Finish();
		bool Sent_gameOver();
		bool Back_TITLE();
		bool CHANGE_Turn();
		void RULE_IMAGE();
	};
}